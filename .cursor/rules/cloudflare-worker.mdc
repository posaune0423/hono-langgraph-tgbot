---
description: Cloudflare Worker specific instructions
globs: src/**/*.ts
alwaysApply: false
---

# Cloudflare Worker specific instructions

基本設定

- compatibility_date は 2024-09-23 以降。
- compatibility_flags に nodejs_compat を含め、HTTP／サーバ API も使うなら enable_nodejs_http_modules と enable_nodejs_http_server_modules を追加。

FS（ファイルシステム）

- node:fs は揮発的な仮想 FS。永続ディスクではない。永続ストレージは R2/KV/D1 を使う。

HTTP／HTTPS

- node:http／node:https のクライアント機能は内部的に fetch。
- サーバ機能（createServer() 等）は Worker のリクエストモデルで動くが、Node と完全同等ではない。

Crypto

- node:crypto は多数対応しているが、DSA/DH・ed448/x448・FIPS 手動切替は非対応。
- 汎用実装なら Web Crypto（crypto.subtle）を優先。

リソース／非対応 API

- CPU 上限デフォルト 30s、最大 5 分（プランによる）。処理を分割／非同期化を推奨。
- child_process／cluster／REPL 等の Node 専用 API は基本不可。

実装スタイル

- Web 標準 API（fetch／Streams／WebCrypto）を優先する。Node 固有 API は最小限に。
- 既存 Node サーバコード持ち込み時は、httpServerHandler 経由への変換を前提に。
